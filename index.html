<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Game Room</title>

  <!-- Telegram -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <!-- Socket.IO client -->
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
</head>
<body>

<h2>–ò–≥—Ä–æ–≤–∞—è ‚Äî –∫–æ–º–Ω–∞—Ç–∞</h2>
<div id="status"></div>
<div id="pot">–ë–∞–Ω–∫: 0</div>

<button onclick="makeBet()">–°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É</button>

<script>
  const tg = window.Telegram.WebApp;
  tg.expand();

  // üîπ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å Telegram
  const user = tg.initDataUnsafe.user || {
    id: Math.random(),
    first_name: "Guest"
  };

  const roomId = "room-1";

  // üîπ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É
  const socket = io("http://localhost:3000"); // –í PROD ‚Äî URL —Å–µ—Ä–≤–µ—Ä–∞

  socket.on("connect", () => {
    document.getElementById("status").innerText =
      "–ü–æ–¥–∫–ª—é—á—ë–Ω –∫–∞–∫ " + user.first_name;

    socket.emit("join_room", {
      roomId,
      user: {
        id: user.id,
        name: user.first_name
      }
    });
  });

  socket.on("room_update", (room) => {
    document.getElementById("pot").innerText =
      "–ë–∞–Ω–∫: " + room.pot;
  });

  socket.on("bet_made", (data) => {
    document.getElementById("pot").innerText =
      "–ë–∞–Ω–∫: " + data.pot;
  });

  function makeBet() {
    socket.emit("bet", {
      roomId,
      amount: 10,
      user: {
        id: user.id,
        name: user.first_name
      }
    });
  }
</script>

</body>
</html>

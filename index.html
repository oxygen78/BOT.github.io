<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Mini Casino</title>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
</head>
<body>

<h2>ðŸŽ® Mini game</h2>

<div id="user"></div>
<div id="balance"></div>

<hr>

<h3>Ð’Ñ‹Ð±Ð¾Ñ€ Ð¸Ð³Ñ€Ñ‹</h3>
<select id="game">
  <option value="dice">ðŸŽ² Dice</option>
  <option value="roulette">ðŸŽ¡ Roulette</option>
</select>

<button onclick="createRoom()">Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ñƒ</button>

<hr>

<h3>Ð’Ð¾Ð¹Ñ‚Ð¸ Ð² ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ñƒ</h3>
<input id="roomId" placeholder="room-id">
<button onclick="joinRoom()">Ð’Ð¾Ð¹Ñ‚Ð¸</button>

<div id="room"></div>

<script>
  const tg = Telegram.WebApp;
  tg.expand();

  const user = tg.initDataUnsafe.user;
  const tgId = user.id;
  const name = user.first_name;

  const socket = io("http://localhost:3000");

  socket.on("connect", () => {
    socket.emit("register", { tgId, name });
  });

  socket.on("user_data", (data) => {
    document.getElementById("user").innerText =
      `ðŸ‘¤ ${data.name} (ID: ${data.tgId})`;

    document.getElementById("balance").innerText =
      `ðŸ’° Ð‘Ð°Ð»Ð°Ð½Ñ: ${data.balance}`;
  });

  function createRoom() {
    const game = document.getElementById("game").value;
    socket.emit("create_room", { tgId, game });
  }

  socket.on("room_created", ({ roomId }) => {
    document.getElementById("room").innerText =
      `ðŸ  ÐšÐ¾Ð¼Ð½Ð°Ñ‚Ð° ÑÐ¾Ð·Ð´Ð°Ð½Ð°: ${roomId}`;
  });

  function joinRoom() {
    const roomId = document.getElementById("roomId").value;
    socket.emit("join_room", { tgId, roomId });
  }

  socket.on("room_update", (room) => {
    document.getElementById("room").innerText =
      `ðŸŽ® Ð˜Ð³Ñ€Ð°: ${room.game}
ðŸ‘¥ Ð˜Ð³Ñ€Ð¾ÐºÐ¾Ð²: ${room.players.length}`;
  });
</script>

</body>
</html>
